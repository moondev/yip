#!/usr/bin/env -S go run github.com/rliebz/tusk@latest boot -c
---
interpreter: bash -c

options:
  gorun:
    default: go run
  gum:
    default: ${gorun} github.com/charmbracelet/gum@latest
  yip:
    default: ${gorun} github.com/moondev/yip@509ee46
  lolcat:
    default:
      command: curl https://pkgs.run/cli/lolcat
  yq3:
    default: ${gorun} github.com/mikefarah/yq/v3@latest
  yq4:
    default: ${gorun} github.com/mikefarah/yq/v4@latest

tasks: 
  boot:
    options:
      config:
        short: 'c'
        default: cloud-config.yaml
    run:
      - |
          cat ${config} | gum write \
          --char-limit=0 \
          --width=0 \
          --height=100 \
          > /tmp/${config}
      - cat /tmp/${config} | gum pager

      - cat /tmp/${config} | ${lolcat}
      - sleep 3
      - echo '#cloud-config' > /tmp/cc.yaml
      - cat /tmp/${config} | ${yq3} r - --stripComments -P >> /tmp/cc.yaml
      - cat /tmp/cc.yaml | ${yq4} -PC
      - sleep 2
      - ${yip} -s boot /tmp/cc.yaml